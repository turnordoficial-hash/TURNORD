(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))i(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function u(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(e){if(e.ep)return;e.ep=!0;const r=u(e);fetch(e.href,r)}})();const I="modulepreload",S=function(n){return"/"+n},x={},C=function(a,u,i){let e=Promise.resolve();if(u&&u.length>0){let o=function(t){return Promise.all(t.map(c=>Promise.resolve(c).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};var d=o;document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),s=l?.nonce||l?.getAttribute("nonce");e=o(u.map(t=>{if(t=S(t),t in x)return;x[t]=!0;const c=t.endsWith(".css"),p=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${t}"]${p}`))return;const m=document.createElement("link");if(m.rel=c?"stylesheet":I,c||(m.as="script"),m.crossOrigin="",m.href=t,s&&m.setAttribute("nonce",s),document.head.appendChild(m),c)return new Promise((E,L)=>{m.addEventListener("load",E),m.addEventListener("error",()=>L(new Error(`Unable to preload CSS for ${t}`)))})}))}function r(l){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=l,window.dispatchEvent(s),!s.defaultPrevented)throw l}return e.then(l=>{for(const s of l||[])s.status==="rejected"&&r(s.reason);return a().catch(r)})},v="https://wjvwjirhxenotvdewbmm.supabase.co",g="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndqdndqaXJoeGVub3R2ZGV3Ym1tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5Mzc1MTEsImV4cCI6MjA4NTUxMzUxMX0.8tze0Dr0Js-aFpOMt7QKa5ImfcDnkZAUKomrjJXjcig";let f,h;new Promise(n=>{h=n});async function b(){try{navigator.onLine||y(!0);let n=null;window.supabase&&typeof window.supabase.createClient=="function"?n=window.supabase.createClient:n=(await C(()=>import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm"),[])).createClient,f=n(v,g,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},functions:{url:`${v}/functions/v1`},global:{headers:{apikey:g}}}),f.supabaseKey=g,h&&h(f)}catch(n){console.error("Error initializing Supabase client:",n),navigator.onLine&&(document.body.innerHTML='<div style="color: red; padding: 20px; text-align: center; font-family: sans-serif;"><h2 style="margin-bottom: 10px;">Error de Conexi√≥n</h2><p>No se pudo establecer conexi√≥n con el servidor de base de datos.</p><button onclick="location.reload()" style="margin-top: 15px; padding: 8px 16px; cursor: pointer;">Reintentar</button></div>')}}function y(n){let a=document.getElementById("offline-banner");n?a||(a=document.createElement("div"),a.id="offline-banner",a.innerHTML=`
        <div style="position: fixed; top: 0; left: 0; right: 0; background: #ea4335; color: white; text-align: center; padding: 10px; z-index: 9999; font-family: sans-serif; font-weight: bold;">
          ‚ö†Ô∏è Sin conexi√≥n a Internet. Algunas funciones pueden no estar disponibles.
        </div>
      `,document.body.prepend(a)):a&&a.remove()}window.addEventListener("online",()=>{y(!1),console.log("Conexi√≥n restaurada."),f||b()});window.addEventListener("offline",()=>{y(!0),console.warn("Conexi√≥n perdida.")});document.readyState!=="loading"?b():document.addEventListener("DOMContentLoaded",b);function w(){if(!document.querySelector("link[rel*='icon']")){const n=document.createElement("link");n.type="image/png",n.rel="shortcut icon",n.href="imegenlogin/favicon-32x32.png",document.getElementsByTagName("head")[0].appendChild(n)}}document.readyState!=="loading"?w():document.addEventListener("DOMContentLoaded",w);"serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js");document.addEventListener("DOMContentLoaded",async()=>{const n=document.getElementById("testimonial-carousel"),a=document.getElementById("prev-testimonio"),u=document.getElementById("next-testimonio");let i=[],e=0;const r=[{nombre_cliente:"Carlos M.",comentario:"El mejor servicio de la ciudad. ¬°Recomendado!",calificacion:5},{nombre_cliente:"David R.",comentario:"Excelente ambiente y profesionales de primera.",calificacion:5},{nombre_cliente:"Juan P.",comentario:"Siempre salgo satisfecho con mi corte.",calificacion:5}],d=o=>{if(i.length===0){n.innerHTML='<p class="text-center text-gray-500 dark:text-gray-400">A√∫n no hay testimonios. ¬°S√© el primero en visitarnos!</p>';return}const t=i[o],c="‚òÖ".repeat(t.calificacion)+"‚òÜ".repeat(5-t.calificacion);n.innerHTML=`
              <div class="flex flex-col items-center justify-center text-center transition-all duration-500 animate-fade-up px-4">
                <div class="text-yellow-400 text-3xl mb-4 tracking-widest">${c}</div>
                <p class="text-xl md:text-2xl text-gray-800 dark:text-gray-200 italic mb-6 leading-relaxed">"${t.comentario}"</p>
                <h4 class="font-bold text-barberRed text-2xl font-['Bebas_Neue'] tracking-wide">${t.nombre_cliente||"Cliente Satisfecho"}</h4>
                <span class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider mt-1 font-bold">Cliente Verificado</span>
              </div>
            `};try{const{data:o,error:t}=await f.from("comentarios").select("nombre_cliente, comentario, calificacion").eq("negocio_id","barberia005").gte("calificacion",4).order("created_at",{ascending:!1}).limit(10);if(t)throw t;i=o&&o.length>0?o:r}catch(o){console.warn("Usando testimonios locales por error de conexi√≥n:",o),i=r}d(0);const l=document.getElementById("fila-live");async function s(){const o=new Date().toISOString().slice(0,10),{count:t,error:c}=await f.from("turnos").select("id",{count:"exact",head:!0}).eq("negocio_id","barberia005").eq("fecha",o).eq("estado","En espera");!c&&l&&(l.innerHTML=`üî• Ahora mismo hay <span class="text-white font-bold text-lg mx-1">${t||0}</span> personas esperando`)}s(),f.channel("comentarios-home").on("postgres_changes",{event:"INSERT",schema:"public",table:"comentarios",filter:"negocio_id=eq.barberia005"},o=>{const t=o.new;t.calificacion>=4&&(i.unshift(t),i.length>10&&i.pop(),e=0,d(e))}).on("postgres_changes",{event:"*",schema:"public",table:"turnos",filter:"negocio_id=eq.barberia005"},()=>{s()}).subscribe(),u.onclick=()=>{i.length>0&&(e=(e+1)%i.length,d(e))},a.onclick=()=>{i.length>0&&(e=(e-1+i.length)%i.length,d(e))},i.length>1&&setInterval(()=>{u.click()},6e3),window.openLightbox=o=>{const t=document.getElementById("lightbox"),c=document.getElementById("lightbox-img");c.src=o,t.classList.remove("hidden"),setTimeout(()=>t.classList.remove("opacity-0"),10)},window.closeLightbox=()=>{const o=document.getElementById("lightbox");o.classList.add("opacity-0"),setTimeout(()=>o.classList.add("hidden"),300)}});
