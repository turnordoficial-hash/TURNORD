<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Panel - JBarber</title>
  <link rel="icon" type="image/png" href="jbarber/jjj.png" />
  <link rel="apple-touch-icon" href="jbarber/jjj.png" />
  <link rel="shortcut icon" href="jbarber/jjj.png" type="image/png"/>
  <link rel="manifest" href="manifest.json">
  
  <!-- OptimizaciÃ³n de Carga -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="dns-prefetch" href="https://wjvwjirhxenotvdewbmm.supabase.co">

  <!-- Inicializar Dark Mode antes de render -->
  <script>
    if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }
  </script>
  <!-- VerificaciÃ³n de SesiÃ³n -->
  <script type="module">
    import { ensureSupabase } from './database.js';
    async function verificarSesion() {
      const supabase = await ensureSupabase();
      const { data: { user } } = await supabase.auth.getUser();
      if (!user) {
        window.location.href = 'login_cliente.html';
        return null; // No user, stop here
      }
      return user;
    }

    async function ensureProfileExists(user) {
      if (!user) return;

      const supabase = await ensureSupabase();
      const negocioId = 'barberia005';

      // Check if a profile exists for the user
      const { data: profile, error } = await supabase
        .from('clientes')
        .select('id')
        .eq('id', user.id)
        .maybeSingle();

      // If profile exists or there was a non-406 error, do nothing.
      if (profile || (error && error.code !== 'PGRST116')) {
        return;
      }

      // Profile does not exist, let's create it.
      console.warn(`Profile for user ${user.id} not found. Creating a fallback profile.`);
      const { error: insertError } = await supabase.from('clientes').insert({
        id: user.id,
        email: user.email,
        nombre: user.user_metadata?.nombre || 'Cliente',
        telefono: user.user_metadata?.telefono,
        negocio_id: negocioId,
      });

      if (insertError) {
        console.error('Error creating fallback profile:', insertError);
      }
    }

    verificarSesion().then(ensureProfileExists);
  </script>
  <script src="admin/tailwind-config.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fuentes: Outfit + Playfair (toque elegante) -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    /* Fondo premium barber */
    body {
      background: #F8F8F9;
      color: #111111;
    }

    html.dark body {
      background: #0B0B0C;
      color: #F5F5F5;
      background-image:
        radial-gradient(1000px 500px at 100% -10%, rgba(193,18,31,0.08), transparent 60%),
        radial-gradient(1000px 500px at -10% 120%, rgba(193,18,31,0.06), transparent 60%);
      background-attachment: fixed;
    }

    /* Tarjetas premium */
    .bento-card {
      background: linear-gradient(145deg, #ffffff, #f1f1f1);
      border: 1px solid rgba(0,0,0,0.04);
      box-shadow: 
        0 4px 20px rgba(0,0,0,0.05),
        0 1px 2px rgba(0,0,0,0.03);
      transition: all 0.3s ease-in-out;
      border-radius: 24px;
    }

    .dark .bento-card {
      background: linear-gradient(145deg, #111113, #0e0e10);
      border: 1px solid rgba(255,255,255,0.05);
      box-shadow: 
        0 8px 30px rgba(0,0,0,0.6);
    }

    .bento-card:hover {
      transform: translateY(-6px);
    }
    
    :root {
      --primary: #C1121F;
      --primary-soft: rgba(193,18,31,0.1);
      --barberBlack: #0B0B0B;
      --barberRed: #C1121F;
      --barberBlue: #003049;
      --barberWhite: #F8F9FA;
    }
    .dark {
      --primary: #3B82F6;
      --primary-soft: rgba(59,130,246,0.15);
    }
    .title-text { color: #111111; }
    .dark .title-text { color: #F5F5F5; }
    .subtitle-text { color: rgba(0,0,0,0.6); }
    .dark .subtitle-text { color: rgba(255,255,255,0.7); }
    .btn-primary { background: var(--primary); color: white; }
    .btn-primary:hover { filter: brightness(0.9); }
    .icon-active { color: var(--primary); }
    .barber-hero {
      background: radial-gradient(circle at top left, rgba(193,18,31,0.16) 0, transparent 55%), radial-gradient(circle at bottom right, rgba(0,48,73,0.22) 0, transparent 55%), linear-gradient(145deg, #0B0B0B, #111827);
    }
    .barber-hero-light {
      background: radial-gradient(circle at top left, rgba(193,18,31,0.12) 0, transparent 55%), radial-gradient(circle at bottom right, rgba(0,48,73,0.16) 0, transparent 55%), linear-gradient(145deg, #FFFFFF, #F8F9FA);
    }
    .hero-title {
      letter-spacing: -0.5px;
      font-weight: 800;
    }
    .barber-chip {
      background: rgba(11,11,11,0.9);
      color: #F8F9FA;
    }
    .dark .barber-chip {
      background: rgba(248,249,250,0.07);
      color: #F8F9FA;
    }
    .barber-promo-card {
      background: linear-gradient(135deg, rgba(193,18,31,0.08), rgba(0,48,73,0.06));
      border: 1px solid rgba(193,18,31,0.18);
    }
    .dark .barber-promo-card {
      background: linear-gradient(135deg, rgba(193,18,31,0.24), rgba(0,48,73,0.3));
      border-color: rgba(248,249,250,0.12);
    }
    .barber-poster-2d {
      transform-origin: center;
      transition: transform .4s ease, box-shadow .4s ease;
    }
    .barber-poster-2d:hover {
      transform: translateY(-8px) scale(1.03);
      box-shadow: 0 25px 60px rgba(0,0,0,0.35);
    }
    .barber-poster-3d {
      transform-style: preserve-3d;
      perspective: 1000px;
      transition: transform .5s ease, box-shadow .5s ease;
    }
    .barber-poster-3d:hover {
      transform: rotateX(8deg) rotateY(-10deg) translateY(-10px);
      box-shadow: 0 30px 80px rgba(0,0,0,0.55);
    }
    .barber-pill {
      background: rgba(11,11,11,0.85);
      color: #F8F9FA;
    }
    .dark .barber-pill {
      background: rgba(248,249,250,0.1);
      color: #F8F9FA;
    }
    
    .section-divider {
      height: 1px;
      background: linear-gradient(to right, transparent, rgba(0,0,0,0.08), transparent);
      margin: 30px 0;
    }
    .dark .section-divider {
      background: linear-gradient(to right, transparent, rgba(255,255,255,0.1), transparent);
    }

    /* TipografÃ­as de titulares */
    .banner-title, .section-title { font-family: 'Playfair Display', serif; letter-spacing: .2px; }
    .banner-text { text-shadow: 0 2px 10px rgba(0,0,0,0.35); }

    /* Chips e insignias */
    .chip { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(6px); }

    /* Animaciones refinadas */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px) } to { opacity: 1; transform: translateY(0) } }
    .animate-fade-in { animation: fadeIn .5s ease-out forwards }
    @keyframes fadeInScale { from { opacity: 0; transform: scale(.96)} to { opacity:1; transform: scale(1)} }
    .slot-enter { animation: fadeInScale .25s ease-out forwards; opacity:0 }
    
    /* Tap Feedback para MÃ³vil */
    .tap-scale { transition: transform 0.15s ease; }
    .tap-scale:active { transform: scale(0.96); }

    /* TransiciÃ³n de PestaÃ±as */
    .tab-panel {
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease;
    }
    .tab-panel.active { opacity: 1; transform: translateY(0); }

    .slot-selected { background-color: #C1121F !important; color: #fff !important; transform: scale(1.04); border-color: #C1121F !important }

    /* Toast */
    #toast-container { position: fixed; top: 20px; right: 20px; z-index: 100 }
    .toast { background: #fff; border-left: 4px solid #22c55e; padding: 14px 16px; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,.08); margin-top: 10px; animation: slideIn .3s ease-out forwards; display: flex; align-items: center; gap: 12px }
    .dark .toast { background: #141416; color: #fff }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0 } to { transform: translateX(0); opacity: 1 } }

    /* FAB y menÃº */
    .fab-menu { transition: all .28s cubic-bezier(.4,0,.2,1); transform: scale(0) translateY(14px); opacity: 0; pointer-events: none }
    .fab-menu.active { transform: scale(1) translateY(0); opacity: 1; pointer-events: auto }
    .fab-btn { transition: transform .28s ease }
    .fab-btn.active { transform: rotate(45deg) }

    /* Barra de progreso estilo barberÃ­a */
    .progress-striped { background-image: repeating-linear-gradient(45deg, rgba(255,255,255,.18) 0 10px, transparent 10px 20px); animation: progress-bar-stripes 1s linear infinite }
    @keyframes progress-bar-stripes { from { background-position: 1rem 0 } to { background-position: 0 0 } }

    /* Safe area mobile */
    .pb-safe { padding-bottom: env(safe-area-inset-bottom) }

    /* Mobile nav refinado */
    .mobile-icon { opacity: .6; transition: transform .2s ease, opacity .2s ease }
    .nav-item.active .mobile-icon { opacity: 1; transform: translateY(-2px) scale(1.08) }

    /* --- MEJORAS VISUALES PREMIUM --- */
    
    /* Textura de Ruido (Efecto Papel/Premium) */
    .bg-noise {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; opacity: 0.04;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
    }

    /* NavegaciÃ³n Flotante (Dock Style) */
    .floating-dock {
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 10px 40px -10px rgba(0,0,0,0.15);
    }
    .dark .floating-dock {
        background: rgba(20, 20, 23, 0.85);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
    }
    @keyframes logoReveal {
      0% { opacity: 0; transform: scale(.8); filter: blur(10px); }
      60% { transform: scale(1.05); }
      100% { opacity: 1; transform: scale(1); filter: blur(0); }
    }
    .logo-animate {
      animation: logoReveal .8s ease-out forwards;
    }
    .promo-shine::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 50%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,.4), transparent);
      transform: skewX(-20deg);
      pointer-events: none;
    }
    .promo-shine:hover::after {
      animation: shine 1s forwards;
    }
    @keyframes shine {
      to { left: 150%; }
    }
    @keyframes ambientGlow {
      0%, 100% { opacity: .6; }
      50% { opacity: 1; }
    }
    .ambient-light {
      animation: ambientGlow 4s ease-in-out infinite;
    }
    @keyframes poleSpin {
      from { transform: rotateY(0deg); }
      to { transform: rotateY(360deg); }
    }
    .barber-pole-3d {
      animation: poleSpin 6s linear infinite;
      transform-style: preserve-3d;
    }
    .page-enter {
      animation: fadeIn .4s ease forwards;
    }
  </style>
</head>
<body class="text-[#111111] dark:text-[#F5F5F5] transition-colors duration-300 font-sans antialiased selection:bg-black selection:text-white dark:selection:bg-white dark:selection:text-black relative">
  <style>
    @keyframes barber-pole-bg {
      from { background-position: 0 0; }
      to { background-position: 56.5px 56.5px; }
    }
    .barber-pole-bg-animated {
      background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23C1121F' fill-opacity='0.04' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
      animation: barber-pole-bg 4s linear infinite;
    }
    .dark .barber-pole-bg-animated {
        background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23FFFFFF' fill-opacity='0.03' fill-rule='evenodd'%3E%3Cpath d='M0 40L40 0H20L0 20M40 40V20L20 40'/%3E%3C/g%3E%3C/svg%3E");
    }
    
    @keyframes float-slow {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    @keyframes float-slower {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-30px) rotate(-5deg); }
    }
    @keyframes float-fast {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-15px) rotate(3deg); }
    }
    .animate-float-slow { animation: float-slow 6s ease-in-out infinite; }
    .animate-float-slower { animation: float-slower 8s ease-in-out infinite; }
    .animate-float-fast { animation: float-fast 4s ease-in-out infinite; }
  </style>

  <!-- Textura Premium -->
  <div class="bg-noise"></div>

  <!-- DecoraciÃ³n de Fondo (BarberÃ­a) -->
  <div class="fixed inset-0 pointer-events-none z-0 overflow-hidden opacity-5 dark:opacity-10">
      <!-- Tijeras -->
      <svg class="absolute top-20 -left-10 w-40 h-40 text-gray-500 transform -rotate-12" viewBox="0 0 24 24" fill="currentColor"><path d="M19,3L13,9L15,11L21,5V3M19,5L15,9L17,11L21,7V5M19,7L17,9L19,11L21,9V7M19,9L18,10L19,11L20,10V9M19,11L19,11L19,11L19,11M12,10.5C12,9.67 11.33,9 10.5,9C9.67,9 9,9.67 9,10.5C9,11.33 9.67,12 10.5,12C11.33,12 12,11.33 12,10.5M10.5,7C10.5,7 10.5,7 10.5,7M10.5,14C10.5,14 10.5,14 10.5,14M7.5,10.5C7.5,9.67 6.83,9 6,9C5.17,9 4.5,9.67 4.5,10.5C4.5,11.33 5.17,12 6,12C6.83,12 7.5,11.33 7.5,10.5M6,7C6,7 6,7 6,7M6,14C6,14 6,14 6,14"/></svg>
      <!-- Navaja -->
      <svg class="absolute bottom-20 -right-10 w-40 h-40 text-gray-500 transform rotate-45" viewBox="0 0 24 24" fill="currentColor"><path d="M19,7H16V5H19V7M19,11H16V9H19V11M19,15H16V13H19V15M19,19H16V17H19V19M14,5H11V19H14V5M9,5H6V7H9V5M9,9H6V11H9V9M9,13H6V15H9V13M9,19H6V17H9V19"/></svg>
      
      <!-- Floating Barber Poles -->
      <div class="absolute top-[10%] left-[5%] text-4xl opacity-40 animate-float-slow">ðŸ’ˆ</div>
      <div class="absolute top-[25%] right-[10%] text-3xl opacity-30 animate-float-slower">ðŸ’ˆ</div>
      <div class="absolute bottom-[15%] left-[15%] text-5xl opacity-20 animate-float-fast">ðŸ’ˆ</div>
      <div class="absolute bottom-[30%] right-[20%] text-4xl opacity-40 animate-float-slow">ðŸ’ˆ</div>
      <div class="absolute top-[50%] left-[50%] text-2xl opacity-20 animate-float-slower transform -translate-x-1/2">ðŸ’ˆ</div>
  </div>

  <!-- Loading Screen -->
  <div id="loading-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-gray-50 dark:bg-black transition-opacity duration-500">
    <div class="flex flex-col items-center">
        <div class="w-16 h-16 border-4 border-black dark:border-white border-t-transparent rounded-full animate-spin"></div>
        <p class="mt-4 text-gray-500 dark:text-gray-400 font-medium animate-pulse">Cargando experiencia...</p>
    </div>
  </div>

  <nav class="bg-[#0B0B0B] border-b border-black/40 sticky top-0 z-50 block">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16 md:h-20">
        <div class="flex-shrink-0">
          <a href="#" class="flex items-center gap-2" onclick="mostrarSeccion('inicio'); return false;">
            <img class="logo-animate h-9 w-auto rounded-lg shadow-sm" src="jbarber/jjj.png" alt="Logo">
            <span class="font-display text-xl md:text-2xl font-bold tracking-tight text-white">
              JBarber <span class="text-[#C1121F]">â€¢</span> Flow
            </span>
          </a>
        </div>

        <div class="hidden md:flex items-center gap-1 bg-white/5 p-1 rounded-full border border-white/10">
           <button class="nav-link px-5 py-2 rounded-full text-sm font-medium text-white/60 hover:text-white hover:bg-white/10 transition-all" data-tab="inicio">Inicio</button>
           <button class="nav-link px-5 py-2 rounded-full text-sm font-medium text-white/60 hover:text-white hover:bg-white/10 transition-all" data-tab="cita">Agendar</button>
           <button class="nav-link px-5 py-2 rounded-full text-sm font-medium text-white/60 hover:text-white hover:bg-white/10 transition-all" data-tab="perfil">Perfil</button>
        </div>

        <div class="flex items-center gap-4">
          <div class="relative">
            <div id="nav-profile-toggle" class="flex items-center gap-3 cursor-pointer group">
              <img id="nav-avatar" src="https://ui-avatars.com/api/?name=U&background=C1121F&color=fff" class="w-8 h-8 md:w-9 md:h-9 rounded-full ring-2 ring-[#C1121F]/50 group-hover:ring-[#C1121F] transition-all object-cover shadow-md">
              <span id="nav-name" class="hidden md:block font-medium text-sm text-white">Cargando...</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white/50 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </div>
            <div id="profile-menu"
     class="hidden absolute top-12 md:top-14 right-0 w-64
            bg-white dark:bg-[#111113]
            rounded-2xl
            shadow-2xl
            z-50
            border border-black/5 dark:border-white/10
            py-2
            transform origin-top-right
            transition-all">
               <div class="px-4 py-2 border-b border-black/5 dark:border-white/10">
              <p class="text-sm font-medium text-[#111111] dark:text-white truncate" id="menu-profile-name">Cargando...</p>
              <p class="text-xs text-black/60 dark:text-white/60 truncate" id="menu-profile-phone">...</p>
            </div>
            <div class="py-1">
              <a id="menu-go-perfil" href="#" class="flex items-center gap-3 px-4 py-3 hover:bg-black/5 dark:hover:bg-white/5 text-sm text-black/80 dark:text-white/80 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                <span>Mi Perfil</span>
              </a>
            </div>
            <!-- Dark Mode Toggle inside Menu -->
            <div class="py-1 border-t border-black/5 dark:border-white/10">
               <button id="theme-toggle-menu" class="w-full text-left flex items-center gap-3 px-4 py-3 hover:bg-black/5 dark:hover:bg-white/5 text-sm text-black/80 dark:text-white/80 transition-colors">
                  <div id="theme-icon-container"></div>
                  <span id="theme-text">Cambiar Tema</span>
               </button>
            </div>
            <div class="py-1 border-t border-black/5 dark:border-white/10">
              <a id="menu-logout" href="#" class="flex items-center gap-3 px-4 py-3 hover:bg-red-900/20 text-sm text-red-400 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                <span>Cerrar SesiÃ³n</span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- BotÃ³n Flotante Modo Oscuro (Solo Inicio) -->
  <button id="floating-theme-toggle" class="tap-scale fixed top-20 md:top-24 right-4 z-40 w-10 h-10 bg-white dark:bg-[#111113] border border-gray-200 dark:border-white/10 rounded-full shadow-xl flex items-center justify-center text-gray-900 dark:text-white hover:scale-110 transition-transform">
    <!-- El icono se inyecta vÃ­a JS -->
  </button>

  <main class="max-w-md mx-auto md:max-w-7xl px-4 py-6 space-y-6 relative z-10 pb-24 md:pb-6">
    
    <div id="tab-inicio-panel" class="animate-fade-in space-y-6">
        <!-- Nueva Tarjeta Principal Premium -->
        <section id="hero-marketing-card" class="relative overflow-hidden rounded-3xl bg-black shadow-2xl border border-white/10 group transition-all duration-500">
            <!-- Efectos de Fondo -->
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-20"></div>
            <div class="absolute -top-24 -right-24 w-64 h-64 bg-[#C1121F]/40 blur-[80px] rounded-full animate-pulse"></div>
            <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-yellow-500/20 blur-[80px] rounded-full"></div>
            
            <div class="relative z-10 p-6 md:p-10 flex flex-col md:flex-row items-center gap-8">
                <!-- Contenido de Texto -->
                <div class="flex-1 text-center md:text-left space-y-5">
                    <div id="hero-badge-container" class="inline-flex items-center gap-2 bg-gradient-to-r from-yellow-500 to-yellow-300 text-black text-[11px] font-bold px-4 py-1 rounded-full transition-all duration-500">
                        <span id="hero-badge-text">ðŸ’Ž Cliente VIP</span>
                    </div>
                    <div id="hero-status-pill" class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/10 border border-white/20 backdrop-blur-md shadow-lg transition-all duration-500">
                        <span class="w-2 h-2 rounded-full bg-[#C1121F] animate-pulse"></span>
                        <span id="hero-status-text" class="text-[10px] font-bold uppercase tracking-widest text-white">JBarber Club</span>
                    </div>
                    
                    <h1 id="hero-title" class="hero-title text-4xl md:text-5xl font-display font-black text-white leading-none tracking-tight drop-shadow-lg transition-all duration-500">
                        Tu estilo, tu regla.<br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#C1121F] via-red-500 to-yellow-300 animate-gradient-x">
                            Sube de nivel hoy.
                        </span>
                    </h1>
                    
                    <p id="hero-subtitle" class="text-gray-300 text-sm font-medium max-w-md mx-auto md:mx-0 leading-relaxed transition-all duration-500">
                        Acumula puntos con cada corte y desbloquea recompensas exclusivas.
                    </p>

                    <div class="flex flex-col sm:flex-row gap-3 pt-2 justify-center md:justify-start">
                        <button onclick="switchTab('cita')" class="relative overflow-hidden px-8 py-4 rounded-xl bg-[#C1121F] text-white font-bold shadow-[0_0_20px_rgba(193,18,31,0.4)] hover:shadow-[0_0_30px_rgba(193,18,31,0.6)] hover:scale-105 transition-all duration-300 group tap-scale">
                            <span class="relative z-10 flex items-center gap-2">
                                AGENDAR AHORA
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" /></svg>
                            </span>
                            <div class="absolute inset-0 bg-gradient-to-r from-red-600 to-red-800 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        </button>
                            <button id="enable-push" class="px-8 py-4 rounded-xl bg-black text-white font-bold hover:bg-black/80 transition-all tap-scale">
                              Activar Notificaciones
                            </button>
                    </div>
                    <p class="text-xs text-gray-300 flex items-center gap-1 pt-1 justify-center md:justify-start">
                        <span class="text-[#C1121F]">âš¡</span>
                        Ãšltimos espacios disponibles hoy
                    </p>
                </div>

                <!-- Elemento Visual (Tarjeta Flotante) -->
                <div class="relative w-full max-w-xs perspective-1000 hidden md:block">
                    <div class="relative transform transition-transform duration-500 hover:rotate-y-12 hover:rotate-x-12 preserve-3d">
                        <div class="bg-gradient-to-br from-[#1a1a1a] to-black border border-white/10 rounded-2xl p-4 shadow-2xl relative overflow-hidden">
                            <!-- Borde Dorado -->
                            <div class="absolute inset-0 border border-yellow-500/30 rounded-2xl pointer-events-none"></div>
                            
                            <div class="relative h-48 rounded-xl overflow-hidden mb-4 group">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent z-10"></div>
                                <img src="jbarber/jjj.png" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700" alt="Barber">
                                <div class="absolute bottom-3 left-3 z-20">
                                    <p class="text-xs text-yellow-400 font-bold uppercase tracking-wider">Session Ready</p>
                                    <p class="text-white font-bold text-lg">BarberÃ­a JBarber</p>
                                </div>
                            </div>

                            <div class="space-y-3">
                                <div class="flex justify-between items-center border-b border-white/5 pb-2">
                                    <span class="text-xs text-gray-400">PrÃ³xima ventana</span>
                                    <span class="text-xs font-bold text-white flex items-center gap-1">
                                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Hoy
                                    </span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-400">Desde</span>
                                    <span class="text-xl font-black text-white">RD$ 0</span>
                                </div>
                            </div>
                        </div>
                        <div class="absolute -top-4 -right-4 bg-yellow-500 text-black text-[10px] font-black px-3 py-1 rounded-full shadow-lg transform rotate-12">
                            PREMIUM
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <div id="inicio-cita-card-container"></div>
        <div id="inicio-status-container" class="grid grid-cols-1 gap-4 mt-4"></div>
    </div>

    <div id="tab-cita-panel" class="hidden animate-fade-in">
        <!-- Contenido Cita -->
    </div>

    <div id="tab-perfil-panel" class="hidden animate-fade-in">
        <!-- Contenido Perfil -->
    </div>

    <!-- Modal CalificaciÃ³n -->
    <div id="modal-calificacion" class="fixed inset-0 z-[60] flex items-center justify-center bg-black bg-opacity-70 hidden opacity-0 transition-opacity duration-300">
        <div class="bento-card rounded-3xl p-8 w-full max-w-md mx-4 transform scale-95 transition-all duration-300 relative overflow-hidden" id="modal-calificacion-content">
            <div class="text-center">
                <div class="w-20 h-20 bg-yellow-50 dark:bg-yellow-900/20 rounded-full flex items-center justify-center mx-auto mb-6 text-yellow-500 shadow-sm border border-yellow-100 dark:border-yellow-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                    </svg>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Â¡Turno Completado!</h3>
                <p class="text-gray-500 dark:text-gray-400 text-sm mb-6">Â¿QuÃ© tal fue tu experiencia con <span id="rating-barber-name" class="font-bold text-gray-800 dark:text-gray-200">el barbero</span>?</p>
                
                <form id="form-calificacion" class="space-y-4">
                    <input type="hidden" id="rating-turno-id">
                    <div class="flex justify-center gap-2 flex-row-reverse group">
                        <input type="radio" name="rating" id="star5" value="5" class="peer/5 hidden">
                        <label for="star5" class="cursor-pointer text-gray-300 peer-checked/5:text-yellow-400 hover:text-yellow-400 peer-hover/5:text-yellow-400 transition-colors">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        </label>
                        <input type="radio" name="rating" id="star4" value="4" class="peer/4 hidden">
                        <label for="star4" class="cursor-pointer text-gray-300 peer-checked/4:text-yellow-400 hover:text-yellow-400 peer-hover/4:text-yellow-400 peer-checked/5:text-yellow-400 peer-hover/5:text-yellow-400 transition-colors">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        </label>
                        <input type="radio" name="rating" id="star3" value="3" class="peer/3 hidden">
                        <label for="star3" class="cursor-pointer text-gray-300 peer-checked/3:text-yellow-400 hover:text-yellow-400 peer-hover/3:text-yellow-400 peer-checked/4:text-yellow-400 peer-hover/4:text-yellow-400 peer-checked/5:text-yellow-400 peer-hover/5:text-yellow-400 transition-colors">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        </label>
                        <input type="radio" name="rating" id="star2" value="2" class="peer/2 hidden">
                        <label for="star2" class="cursor-pointer text-gray-300 peer-checked/2:text-yellow-400 hover:text-yellow-400 peer-hover/2:text-yellow-400 peer-checked/3:text-yellow-400 peer-hover/3:text-yellow-400 peer-checked/4:text-yellow-400 peer-hover/4:text-yellow-400 peer-checked/5:text-yellow-400 peer-hover/5:text-yellow-400 transition-colors">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        </label>
                        <input type="radio" name="rating" id="star1" value="1" class="peer/1 hidden">
                        <label for="star1" class="cursor-pointer text-gray-300 peer-checked/1:text-yellow-400 hover:text-yellow-400 peer-hover/1:text-yellow-400 peer-checked/2:text-yellow-400 peer-hover/2:text-yellow-400 peer-checked/3:text-yellow-400 peer-hover/3:text-yellow-400 peer-checked/4:text-yellow-400 peer-hover/4:text-yellow-400 peer-checked/5:text-yellow-400 peer-hover/5:text-yellow-400 transition-colors">
                            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/></svg>
                        </label>
                    </div>
                    
                    <textarea id="rating-comment" rows="3" placeholder="Â¿AlgÃºn comentario sobre el servicio?" class="w-full p-3 rounded-xl bg-[#F8F8F9] dark:bg-[#111113]/50 border border-black/5 dark:border-white/10 text-[#111111] dark:text-white focus:ring-2 focus:ring-black dark:focus:ring-white outline-none resize-none text-sm"></textarea>
                    
                    <div class="flex gap-3 pt-2">
                        <button type="button" id="btn-rating-omit" class="flex-1 py-3.5 rounded-2xl font-bold text-gray-500 hover:bg-white/5 transition-colors text-sm">Omitir</button>
                        <button type="submit" class="flex-1 py-3.5 rounded-2xl font-bold bg-black dark:bg-white text-white dark:text-black shadow-lg hover:bg-black/80 dark:hover:bg-white/90 transition-all transform hover:scale-[1.02] focus:outline-none text-sm">Enviar OpiniÃ³n</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal ConfirmaciÃ³n GenÃ©rico -->
    <div id="modal-confirmacion" class="fixed inset-0 z-[70] flex items-center justify-center bg-black bg-opacity-70 hidden opacity-0 transition-opacity duration-300">
        <div class="bento-card rounded-3xl p-8 w-full max-w-sm mx-4 transform scale-95 transition-all duration-300 relative overflow-hidden" id="modal-confirmacion-content">
            <h3 id="confirm-title" class="text-2xl font-bold text-[#111111] dark:text-white mb-2">Confirmar</h3>
            <p id="confirm-message" class="text-black/60 dark:text-white/60 text-sm mb-6 whitespace-pre-line">Â¿EstÃ¡s seguro?</p>
            <div class="flex gap-3">
                <button id="btn-confirm-cancel" class="flex-1 py-3 rounded-xl font-bold text-black/50 hover:bg-black/5 transition-colors text-sm">Cancelar</button>
                <button id="btn-confirm-ok" class="flex-1 py-3 rounded-xl font-bold bg-black dark:bg-white text-white dark:text-black shadow-lg hover:bg-black/80 dark:hover:bg-white/90 transition-all transform hover:scale-[1.02] text-sm">Confirmar</button>
            </div>
        </div>
    </div>

  </main>

  <!-- Bottom Navigation (Mobile Only) -->
  <nav class="md:hidden fixed bottom-0 left-0 w-full z-50 bg-[#C1121F] border-t border-red-700 pb-safe shadow-[0_-4px_20px_rgba(193,18,31,0.3)]">
    <div class="flex justify-around items-center h-16 px-2">
      <button class="nav-item flex flex-col items-center justify-center w-full h-full text-white/70 hover:text-white active:scale-95 transition-all group" data-tab="inicio">
        <div class="p-1.5 rounded-xl group-hover:bg-white/10 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mobile-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>
        </div>
        <span class="text-[10px] font-bold tracking-wide">Inicio</span>
      </button>
      <button class="nav-item tap-scale flex flex-col items-center justify-center w-full h-full text-white/70 hover:text-white active:scale-95 transition-all group" data-tab="cita">
        <div class="p-1.5 rounded-xl group-hover:bg-white/10 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mobile-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
        </div>
        <span class="text-[10px] font-bold tracking-wide">Agenda</span>
      </button>
      <button class="nav-item flex flex-col items-center justify-center w-full h-full text-white/70 hover:text-white active:scale-95 transition-all group" data-tab="perfil">
        <div class="p-1.5 rounded-xl group-hover:bg-white/10 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mobile-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
        </div>
        <span class="text-[10px] font-bold tracking-wide">Perfil</span>
      </button>
    </div>
  </nav>

  <!-- Floating Action Button (Contact) -->
  <div class="fixed bottom-20 md:bottom-6 right-6 z-40 flex flex-col items-end gap-3">
    <div id="fab-menu" class="fab-menu flex flex-col gap-3 items-end mb-2">
      <a href="https://wa.me/18295877564" target="_blank" class="flex items-center gap-2 group">
        <span class="bg-white dark:bg-[#111113] text-gray-700 dark:text-gray-200 text-xs font-bold px-2 py-1 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity">WhatsApp</span>
        <div class="w-10 h-10 bg-[#25D366] text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.626.712.226 1.36.194 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
        </div>
      </a>
      <a href="tel:+18295877564" class="flex items-center gap-2 group">
        <span class="bg-white dark:bg-[#111113] text-gray-700 dark:text-gray-200 text-xs font-bold px-2 py-1 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity">Llamar</span>
        <div class="w-10 h-10 bg-blue-600 text-white rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
        </div>
      </a>
      <a href="https://maps.google.com/?q=JBarber" target="_blank" class="flex items-center gap-2 group">
        <span class="bg-white dark:bg-[#111113] text-gray-700 dark:text-gray-200 text-xs font-bold px-2 py-1 rounded shadow-md opacity-0 group-hover:opacity-100 transition-opacity">Mapa</span>
        <div class="w-10 h-10 bg-black dark:bg-white text-white dark:text-black rounded-full shadow-lg flex items-center justify-center hover:scale-110 transition-transform">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        </div>
      </a>
    </div>
    <button id="fab-main" class="fab-btn w-14 h-14 bg-black dark:bg-white hover:bg-black/80 dark:hover:bg-white/90 text-white dark:text-black rounded-full shadow-xl flex items-center justify-center transition-all z-50 ring-2 ring-white/10">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg>
    </button>
  </div>

  <script type="module">
    import { ensureSupabase } from './database.js';
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(async function(OneSignal) {
      await OneSignal.init({ 
        appId: '85f98db3-968a-4580-bb02-8821411a6bee',
        serviceWorkerPath: 'sw.js'
      });
      const negocioId = 'barberia005';
      OneSignal.User.addAlias('negocio_id', negocioId);
      const supabase = await ensureSupabase();
      const { data: { user } } = await supabase.auth.getUser();
      if (user) {
        const { data: profile } = await supabase.from('clientes').select('telefono, nombre').eq('id', user.id).maybeSingle();
        const tel = profile?.telefono || user.user_metadata?.telefono;
        const name = profile?.nombre || user.user_metadata?.nombre;
        if (tel) {
            // CORRECCIÃ“N: Asegurar identidad limpia para evitar conflictos 409
            OneSignalDeferred.push(async function(OneSignal) {
              const currentExternalId = OneSignal.User.externalId;
              if (currentExternalId && currentExternalId !== String(tel)) {
                await OneSignal.logout();
              }
              await OneSignal.login(String(tel));
              if (name) OneSignal.User.addTag("nombre", name);
            });
        }
      }
    });
  </script>
  <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
  <script type="module" src="admin/panel-cliente.js"></script>
  <script>
    window.OneSignalDeferred = window.OneSignalDeferred || [];
    OneSignalDeferred.push(function(OneSignal) {
      // Solicitar permiso automÃ¡ticamente al cargar si no estÃ¡ concedido (v16 SDK)
      if (!OneSignal.Notifications.permission) {
        OneSignal.Notifications.requestPermission().catch(function(err) {
          console.warn('Error al solicitar permiso push:', err);
        });
      }

      var btn = document.getElementById('enable-push');
      if (!btn) return;

      // Actualizar visibilidad inicial
      if (OneSignal.Notifications.permission) btn.style.display = 'none';

      btn.addEventListener('click', function(){
        OneSignal.Notifications.requestPermission().catch(function(){});
      });

      OneSignal.Notifications.addEventListener('permissionChange', function(permission){
        if (permission) btn.style.display = 'none';
      });
    });
  </script>
</body>
</html>
